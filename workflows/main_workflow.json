{
    "nodes": [
      {
        "name": "Webhook",
        "type": "n8n-nodes-base.webhook",
        "parameters": {
          "httpMethod": "POST",
          "path": "support-request"
        }
      },
      {
        "name": "OpenAI Analysis",
        "type": "n8n-nodes-base.openAi",
        "parameters": {
          "resource": "chat",
          "model": "gpt-3.5-turbo",
          "temperature": 0.2,
          "maxTokens": 256,
          "systemMessage": "Analyze customer sentiment (1-5) and categorize request into [Billing, Technical, Account, General]. Respond in JSON format.",
          "messages": [
            {
              "message": {
                "role": "user",
                "content": "{{ $json.body.message }}"
              }
            }
          ]
        }
      },
      {
        "name": "CRM Update",
        "type": "n8n-nodes-base.airTable",
        "parameters": {
          "operation": "create",
          "base": "{{ $env.AIRTABLE_BASE_ID }}",
          "table": "SupportTickets",
          "fields": {
            "Customer": "{{ $json.webhook.body.email }}",
            "Issue": "{{ $json.openAi.response.choices[0].message.content }}",
            "Priority": "{{ $json.priority }}"
          }
        }
      },
      {
        "name": "Redis Memory",
        "type": "n8n-nodes-base.executeCommand",
        "parameters": {
          "command": "python3 /data/scripts/conversation_memory.py",
          "arguments": "--customer-email '{{ $json.webhook.body.email }}' --message '{{ $json.webhook.body.message }}'"
        }
      },
      {
        "name": "Response Email",
        "type": "n8n-nodes-base.emailSend",
        "parameters": {
          "subject": "Support Request Received",
          "body": "We've received your request ({{ $json.openAi.response.choices[0].message.content.category }}) and will respond within 24 hours.",
          "to": "{{ $json.webhook.body.email }}"
        }
      }
    ],
    "connections": {
      "Webhook": {
        "main": [
          [
            {
              "node": "OpenAI Analysis",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "OpenAI Analysis": {
        "main": [
          [
            {
              "node": "CRM Update",
              "type": "main",
              "index": 0
            }
          ]
        ]
      }
    }
  }